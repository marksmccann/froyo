!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).froyojs={})}(this,(function(t){"use strict";function e(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,n(t,e,"get"))}function i(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,n(t,e,"set"),i),i}function n(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function r(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}let s=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;return crypto.getRandomValues(new Uint8Array(t)).reduce(((t,e)=>t+=(e&=63)<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_"),"")};var a=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap;class d{get components(){return Object.fromEntries(e(this,a))}set components(t){Object.entries(t).forEach((t=>{let[i,n]=t;n instanceof d?(e(this,a).has(i)&&e(this,a).get(i).destroy(),e(this,a).set(i,n)):console.error(`Warning: component "${i}" is not an instance of "Component"`)}))}get displayName(){const{name:t,displayName:e}=this.constructor;return e||t}get listeners(){return Object.fromEntries(e(this,o))}set listeners(t){Object.entries(t).forEach((t=>{let[i,n]=t;"function"==typeof n?.destroy?(e(this,o).has(i)&&e(this,o).get(i).destroy(),e(this,o).set(i,n)):console.error(`Warning: listener "${i}" is missing a "destroy" function`)}))}get metadata(){return{...e(this,l)}}get rootElement(){return e(this,h)}get state(){return{...e(this,u)}}set state(t){e(this,l).initialized?console.error('Warning: state can only be updated via "setState" after initialization'):this.setState(t)}constructor(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,a,{writable:!0,value:new Map}),r(this,o,{writable:!0,value:new Map}),r(this,l,{writable:!0,value:{}}),r(this,c,{writable:!0,value:new Set}),r(this,h,{writable:!0,value:null}),r(this,u,{writable:!0,value:{}});let d={};if(t instanceof Element)if(this.render){if(t.hasAttribute("data-initial-state"))try{d=JSON.parse(t.getAttribute("data-initial-state"))}catch{console.error('Warning: "data-initial-state" must contain valid JSON')}i(this,h,t),i(this,l,{initialized:!1,id:s(8)}),this.setState({...d,...n}),this.initialize(),this.initialize=this.initialize.bind(this),this.validate=this.validate.bind(this),this.render=this.render.bind(this),this.update=this.update.bind(this),this.subscribe(this.validate),this.subscribe(this.render),this.subscribe(this.update),this.validate(this.state,{},this),this.render(this.state,{},this),this.update(this.state,{},this),e(this,l).initialized=!0}else console.error('Warning: components must have a "render" method');else console.error("Warning: the root element must be an HTML element")}destroy(){e(this,c).clear(),e(this,o).forEach((t=>t.destroy())),e(this,a).forEach((t=>t.destroy()))}setState(t){const{defaultState:n={},stateTypes:r={}}=this.constructor,{initialized:s}=this.metadata,a=this.state,o={};if(Object.entries(t).forEach((t=>{let[e,i]=t;i!==a[e]&&(o[e]=i)})),Object.keys(o).length>0||!s){const t={...a,...o};Object.keys(n).forEach((e=>{void 0===t[e]&&(t[e]=n[e])})),i(this,u,t),s&&e(this,c).forEach((t=>{t(o,a,this)}))}}subscribe(t){"function"==typeof t?e(this,c).has(t)||e(this,c).add(t):console.error('Warning: a function must be provided to "subscribe"')}unsubscribe(t){e(this,c).has(t)&&e(this,c).delete(t)}initialize(){}validate(){}update(){}}function f(t,e){Object.entries(e??{}).forEach((e=>{let[i,n]=e;null===n?t.removeAttribute(i):t.setAttribute(i,n)}))}t.Component=d,t.addEventListener=function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return t.addEventListener(...i),{destroy(){t.removeEventListener(...i)}}},t.createElement=function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const n=document.createElement(t);return f(n,e),"string"==typeof i?n.innerHTML=i:n.appendChild(i),n},t.createInitializer=function(t){return function(){const e=document.querySelectorAll("[data-initialize]"),i=[];return Array.from(e).forEach((e=>{const n=e.getAttribute("data-initialize"),r=t[n];r.prototype instanceof d?(e.removeAttribute("data-initialize"),i.push(new r(e))):console.error(`Warning: "${n}" is not a valid "Component" constructor`)})),i}},t.createMediaQueryListener=function(t,e){const i=window.matchMedia(t);return i.addEventListener("change",e),{media:i,destroy(){i.removeEventListener("change",e)}}},t.createMutationObserver=function(t,e,i){const n=new MutationObserver(e);return n.observe(t,i),{observer:n,destroy(){n.disconnect()}}},t.querySelectorAll=function(t,e){return Array.from(t.querySelectorAll(e))},t.setAttributes=f}));
