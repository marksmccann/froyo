!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).froyojs={})}(this,(function(e){"use strict";const t=new Set;class s{static get instances(){return Array.from(t)}#e=new Map;#t={};#s=!1;#i=new Map;#n=new Set;#r=null;#o={};get components(){return Object.fromEntries(this.#e)}set components(e){Object.entries(e).forEach((([e,t])=>{t instanceof s?(this.#e.has(e)&&this.#e.get(e).destroy(),this.#e.set(e,t)):console.error(`Warning: component "${e}" is not an instance of "Component"`)}))}get displayName(){const{name:e,displayName:t}=this.constructor;return t||e}get elements(){return{...this.#t}}set elements(e){Object.entries(e).forEach((([e,t])=>{t instanceof Node||null===t?this.#t[e]=t:t instanceof NodeList||t instanceof HTMLCollection?this.#t[e]=Array.from(t):console.error(`Warning: value assigned to "elements.${e}" is not a valid DOM node`)}))}get listeners(){return Object.fromEntries(this.#i)}set listeners(e){Object.entries(e).forEach((([e,t])=>{"function"==typeof t?.destroy?(this.#i.has(e)&&this.#i.get(e).destroy(),this.#i.set(e,t)):console.error(`Warning: listener "${e}" is missing a "destroy" function`)}))}get initialized(){return this.#s}get rootElement(){return this.#r}get state(){return{...this.#o}}set state(e){this.initialized?console.error('Warning: state can only be updated via "setState" after initialization'):this.setState(e)}constructor(e,s={}){let i={},n=e;if("string"==typeof n&&(n=document.body.querySelector(e)),n instanceof Element)if(this.render){if(n.hasAttribute("data-initial-state"))try{i=JSON.parse(n.getAttribute("data-initial-state"))}catch{console.error('Warning: "data-initial-state" must contain valid JSON')}this.#r=n,this.setup=this.setup.bind(this),this.validate=this.validate.bind(this),this.render=this.render.bind(this),this.update=this.update.bind(this),this.subscribe(this.validate),this.subscribe(this.render),this.subscribe(this.update),this.setState({...i,...s}),this.setup(),this.validate(this.state,{},this),this.render(this.state,{},this),this.update(this.state,{},this),this.#s=!0,t.add(this)}else console.error('Warning: components must have a "render" method');else console.error("Warning: the root element must be an HTML element")}destroy(){this.#n.clear(),this.#i.forEach((e=>e.destroy())),this.#e.forEach((e=>e.destroy())),t.delete(this)}setState(e){const{defaultState:t={},stateTypes:s={}}=this.constructor,i=this.state,n={};if(Object.entries(e).forEach((([e,t])=>{t!==i[e]&&(n[e]=t)})),Object.keys(n).length>0||!this.initialized){const e={...i,...n};Object.keys(t).forEach((s=>{void 0===e[s]&&(e[s]=t[s])})),this.#o=e,this.initialized&&this.#n.forEach((e=>{e(n,i,this)}))}}subscribe(e){"function"==typeof e?this.#n.has(e)||this.#n.add(e):console.error('Warning: a function must be provided to "subscribe"')}unsubscribe(e){this.#n.has(e)&&this.#n.delete(e)}setup(){}validate(){}update(){}}function i(e,t){Object.entries(t??{}).forEach((([t,s])=>{null===s?e.removeAttribute(t):void 0!==s&&e.setAttribute(t,s)}))}e.Component=s,e.addEventListener=function(e,...t){return e.addEventListener(...t),{destroy(){e.removeEventListener(...t)}}},e.createElement=function(e,t,s=""){const n=document.createElement(e);return i(n,t),"string"==typeof s?n.innerHTML=s:n.appendChild(s),n},e.createInitializer=function(e){return function(){const t=document.querySelectorAll("[data-initialize]"),i=[];return Array.from(t).forEach((t=>{const n=t.getAttribute("data-initialize"),r=e[n];r.prototype instanceof s?(t.removeAttribute("data-initialize"),i.push(new r(t))):console.error(`Warning: "${n}" is not a valid "Component" constructor`)})),i}},e.createMediaQueryListener=function(e,t){const s=window.matchMedia(e);return s.addEventListener("change",t),{media:s,destroy(){s.removeEventListener("change",t)}}},e.createMutationObserver=function(e,t,s){const i=new MutationObserver(t);return i.observe(e,s),{observer:i,destroy(){i.disconnect()}}},e.setAttributes=i,e.setClasses=function(e,t){Object.entries(t).forEach((t=>{e.classList[t[1]?"add":"remove"](t[0])}))}}));
