!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).froyojs={})}(this,(function(t){"use strict";function e(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function i(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i}var n,s,r,o,a,c,h;const f=new Set;class d{static get instances(){return Array.from(f)}get components(){return Object.fromEntries(e(this,n,"f"))}set components(t){Object.entries(t).forEach((([t,i])=>{i instanceof d?(e(this,n,"f").has(t)&&e(this,n,"f").get(t)?.destroy(),e(this,n,"f").set(t,i)):console.error(`Warning: component "${t}" is not an instance of "Component"`)}))}get displayName(){const{name:t,displayName:e}=this.constructor;return e||t}get elements(){return{...e(this,s,"f")}}set elements(t){Object.entries(t).forEach((([t,i])=>{i instanceof Node||null===i?e(this,s,"f")[t]=i:i instanceof NodeList||i instanceof HTMLCollection?e(this,s,"f")[t]=Array.from(i):console.error(`Warning: value assigned to "elements.${t}" is not a valid DOM node`)}))}get listeners(){return Object.fromEntries(e(this,o,"f"))}set listeners(t){Object.entries(t).forEach((([t,i])=>{"function"==typeof i?.destroy?(e(this,o,"f").has(t)&&e(this,o,"f").get(t)?.destroy(),e(this,o,"f").set(t,i)):console.error(`Warning: listener "${t}" is missing a "destroy" function`)}))}get initialized(){return e(this,r,"f")}get rootElement(){return e(this,c,"f")}get state(){return{...e(this,h,"f")}}set state(t){this.initialized?console.error('Warning: state can only be updated via "setState" after initialization'):this.setState(t)}constructor(t,e={}){n.set(this,new Map),s.set(this,{}),r.set(this,!1),o.set(this,new Map),a.set(this,new Set),c.set(this,void 0),h.set(this,{});let d={},u=null;if("string"==typeof t?u=document.body.querySelector(t):t instanceof Element&&(u=t),!(u instanceof Element))throw new Error("Warning: the root element must be an HTML element");if(i(this,c,u,"f"),u.hasAttribute("data-initial-state"))try{d=JSON.parse(u.getAttribute("data-initial-state")||"")}catch{console.error('Warning: "data-initial-state" must contain valid JSON')}this.state={...d,...e},this.setup&&this.setup(),this.validate&&(this.subscribe(this.validate.bind(this)),this.validate(this.state,{},this)),this.render&&(this.subscribe(this.render.bind(this)),this.render(this.state,{},this)),void 0!==this.update&&(this.subscribe(this.update.bind(this)),this.update(this.state,{},this)),i(this,r,!0,"f"),f.add(this)}destroy(){e(this,a,"f").clear(),e(this,o,"f").forEach((t=>t.destroy())),e(this,n,"f").forEach((t=>t.destroy())),f.delete(this)}setState(t){const{defaultState:n={},stateTypes:s={}}=this.constructor,r=this.state,o={};if(Object.entries(t).forEach((([t,e])=>{e!==r[t]&&(o[t]=e)})),Object.keys(o).length>0||!this.initialized){const t={...r,...o};Object.keys(n).forEach((e=>{void 0===t[e]&&(t[e]=n[e])})),i(this,h,t,"f"),this.initialized&&e(this,a,"f").forEach((t=>{t(o,r,this)}))}}subscribe(t){"function"==typeof t?e(this,a,"f").has(t)||e(this,a,"f").add(t):console.error('Warning: a function must be provided to "subscribe"')}unsubscribe(t){e(this,a,"f").has(t)&&e(this,a,"f").delete(t)}}function u(t,e={}){Object.entries(e).forEach((([e,i])=>{null===i?t.removeAttribute(e):void 0!==i&&t.setAttribute(e,i)}))}n=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,c=new WeakMap,h=new WeakMap,t.Component=d,t.addEventListener=function(t,e,i,n){return t.addEventListener(e,i,n),{destroy(){t.removeEventListener(e,i,n)}}},t.createElement=function(t,e,i=""){const n=document.createElement(t);return e&&u(n,e),"string"==typeof i?n.innerHTML=i:n.appendChild(i),n},t.createInitializer=function(t){return function(){const e=document.querySelectorAll("[data-initialize]"),i=[];return Array.from(e).forEach((e=>{const n=e.getAttribute("data-initialize")||"";n in t&&t[n].prototype instanceof d?(e.removeAttribute("data-initialize"),i.push(new t[n](e))):console.error(`Warning: "${n}" is not a valid "Component" constructor`)})),i}},t.createMediaQueryListener=function(t,e){const i=window.matchMedia(t);return i.addEventListener("change",e),{media:i,destroy(){i.removeEventListener("change",e)}}},t.createMutationObserver=function(t,e,i){const n=new MutationObserver(e);return n.observe(t,i),{observer:n,destroy(){n.disconnect()}}},t.setAttributes=u,t.setClasses=function(t,e){Object.entries(e).forEach((e=>{t.classList[e[1]?"add":"remove"](e[0])}))}}));
